# Railway Environment Variables - Setup Guide

## ⚡ MINIMÁLNÍ KONFIGURACE (povinná)

```env
# Database - Railway PostgreSQL plugin vytvoří automaticky
DATABASE_URL=<auto-generated by Railway>

# JWT Secret - použij vygenerovaný secret
JWT_SECRET=fb561332843033ad866a5de23816ae327b13fb81ebce93f719e60b3b90325a6020aadb86d86ee3deecd4b8c9ac3a5460d9d64e8d2633bc5a3ca3ee9b38b19a08

# Environment
NODE_ENV=production
```

**Jak nastavit:**
1. Railway Dashboard → Tvůj projekt → "Variables"
2. Klikni "New Variable"
3. Přidej `JWT_SECRET` s hodnotou výše
4. Přidej `NODE_ENV=production`
5. DATABASE_URL se vytvoří automaticky když přidáš PostgreSQL plugin

---

skvělé

## 📧 EMAIL SERVICE (volitelné - pro notifikace)

### SendGrid (DOPORUČENO - free 100 emails/den)

```env
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASS=<tvůj SendGrid API key z https://sendgrid.com>
FROM_EMAIL=noreply@digikop.cz
```

### Gmail (jednodušší alternativa)

```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=tvuj.email@gmail.com
SMTP_PASS=<app-specific password z Google Account>
FROM_EMAIL=tvuj.email@gmail.com
```

**Bez emailů:**
Aplikace funguje, jen nebude posílat notifikace. V logs uvidíš:
```
⚠️ Email service not available - notifications will be queued but not sent
```

---

## 🗺️ MAPBOX (povinné pro mapy)

```env
MAPBOX_ACCESS_TOKEN=<token z https://www.mapbox.com>
```

**Jak získat:**
1. Registruj se na https://www.mapbox.com (free tier)
2. Account → Access tokens → Create token
3. Zkopíruj token začínající `pk.eyJ...`

⚠️ **Bez Mapbox tokenu mapy nebudou fungovat!**

---

## 👤 ADMIN ÚČET (volitelné)

```env
ADMIN_EMAIL=admin@digikop.cz
ADMIN_PASSWORD=SilneHeslo123!
```

Pokud nenastavíš, vytvoří se default admin:
- Email: `admin@digikop.cz`
- Password: `Admin123!`

⚠️ **ZMĚŇ heslo po prvním přihlášení!**

---

## 📦 UPLOAD PATH (automatické)

```env
# Railway nastaví automaticky - nepřidávej manuálně
UPLOAD_PATH=/tmp/uploads
```

Railway má dočasný filesystem, persistentní storage řeš přes S3/Cloudinary.

---

## ✅ KONTROLNÍ SEZNAM

Před deploymentem zkontroluj v Railway Variables:

- [x] DATABASE_URL (auto-generated po přidání PostgreSQL)
- [x] JWT_SECRET (vygenerovaný 128-char string)
- [x] NODE_ENV=production
- [ ] MAPBOX_ACCESS_TOKEN (povinné pro mapy)
- [ ] SMTP_* proměnné (pokud chceš email notifikace)
- [ ] ADMIN_EMAIL/PASSWORD (nebo použij default)

---

## 🔍 DEBUGGING

### Zkontroluj Railway Logs:

```bash
Railway Dashboard → Deployments → Latest → Logs
```

Hledej tyto zprávy:

**✅ Úspěšný start:**
```
✅ Configuration validated
✅ PostGIS version: 3.x.x
✅ All required tables created successfully
✅ Admin user already exists
🎉 Database migration completed successfully!
🚀 DigiKop server running on port 3000
```

**❌ Chybějící proměnné:**
```
❌ Configuration validation failed: Missing required environment variables: DATABASE_URL, JWT_SECRET
```

**❌ PostGIS chybí:**
```
❌ Failed to enable PostGIS extension
```
→ Řešení: Použij Railway PostgreSQL plugin (má PostGIS)

---

## 🚀 DEPLOY CHECKLIST

1. ✅ Přidej PostgreSQL plugin v Railway
2. ✅ Nastav JWT_SECRET v Variables
3. ✅ Nastav MAPBOX_ACCESS_TOKEN v Variables
4. ✅ (Volitelné) Nastav SMTP credentials
5. ✅ Push změny na GitHub
6. ✅ Railway automaticky deployuje
7. ✅ Čekej na "Deployment successful"
8. ✅ Otestuj: `https://your-app.railway.app/api/health`
9. ✅ Přihlaš se jako admin
10. ✅ Změň admin heslo!
